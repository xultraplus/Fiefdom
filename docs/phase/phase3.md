在完成了**核心种田机制**（第一阶段）和**门客自动化管理**（第二阶段）之后，你的游戏已经具备了“模拟经营”的底子。

**第三阶段（Phase 3）的核心目标**是：**“君子六艺与百家争鸣” (Progression & Interaction)**。

这一阶段要赋予游戏**RPG 元素**和**世界观深度**。单纯的种田和管理会很快枯燥，必须通过“六艺技能树”给玩家长期目标，通过“诸子百家”的社交给玩家带来随机性和故事感。

**建议周期**：4-6 周。

---

### 第三阶段开发计划表

#### 第一周：六艺属性与成长系统 (The Six Arts RPG System)
**目标**：建立玩家的属性面板，并让日常行为能增加经验值。

1.  **数据结构**：
    *   建立 `PlayerStats` 资源（或单例变量）。
    *   定义 6 个核心属性：`礼(Rites)`, `乐(Music)`, `射(Archery)`, `御(Driving)`, `书(Literacy)`, `数(Math)`。
    *   每个属性包含：`level` (当前等级), `current_xp` (当前经验), `max_xp` (升级所需).
2.  **经验获取钩子 (XP Hooks)**：
    *   在现有代码中埋点：
        *   收获作物 -> 增加 `数` 经验（计算产出）。
        *   读书（新动作） -> 增加 `书` 经验。
        *   祭祀（新动作） -> 增加 `礼` 经验。
3.  **UI 面板**：
    *   制作一个“竹简风格”的角色面板，显示六边形雷达图（Godot 可以用 `Polygon2D` 动态绘制）或简单的进度条。

#### 第二周：社交与访客系统 (Social & Visitors)
**目标**：让世界活起来，而不是只有哑巴门客。

1.  **访客生成器 (Visitor Spawner)**：
    *   **机制**：每天早晨有概率在“村口”生成特殊 NPC（儒家士子、墨家游侠、邻国商人）。
    *   **数据驱动**：创建 `VisitorData` 资源，包含 `name`, `portrait`, `dialogue_id`, `school_type`。
2.  **对话系统 (Dialogue System)**：
    *   **技术选型**：不要自己写复杂的解析器。推荐使用 Godot 插件 **Dialogue Manager** 或 **Godot-Dialogue-System**。如果想轻量化，就用简单的 JSON 字典。
    *   **交互逻辑**：
        *   靠近 NPC -> 按交互键 -> 弹出对话框。
        *   选项：A. 论道（增加好感/获得声望）；B. 交易；C. 驱逐。
3.  **好感度 (Relationship)**：
    *   简单的字典：`{ "npc_id": value }`。
    *   好感度高了，NPC 可能会赠送特殊种子或图纸。

#### 第三周：初级战斗与狩猎 (Combat Prototype - "She")
**目标**：验证“射”艺，提供除种田外的资源获取途径。

1.  **武器系统**：
    *   给主角添加武器槽位。先做最简单的：**弓箭**。
    *   **机制**：鼠标点击 -> 实例化箭矢 (RigidBody2D 或 Area2D) -> 飞向鼠标方向。
2.  **简单的野外地图**：
    *   创建一个新的 Scene：`Wilderness.tscn`。
    *   通过地图边缘的传送门（Area2D）在“封地”和“野外”之间切换。
3.  **敌人 AI**：
    *   做一个简单的“野猪”或“盗匪”。
    *   AI 逻辑：发现玩家 -> 追逐 -> 接触造成伤害。
    *   **掉落**：击杀后掉落“兽肉”（祭祀用）或“皮革”（工艺用）。

#### 第四周：科技树与爵位晋升 (Tech Tree & Rank)
**目标**：将六艺等级转化为实际的游戏优势。

1.  **科技树 UI**：
    *   制作一个简单的技能树界面。
    *   **解锁逻辑**：
        *   如果 `书` 等级 >= 3，解锁【水利工程】（允许建造水渠）。
        *   如果 `射` 等级 >= 2，解锁【复合弓配方】。
2.  **爵位系统**：
    *   这是游戏的里程碑。
    *   **条件**：声望达标 + 公田纳贡达标 + 拥有特定礼器。
    *   **效果**：从“下士”升为“中士”，解锁更大的地图区域，增加门客上限。

---

### 关键技术难点与 Godot 解决方案

#### 1. 对话系统的整合
*   **推荐插件**：[Dialogue Manager](https://github.com/nathanhoad/godot_dialogue_manager)。
*   **用法**：
    *   编写 `.dialogue` 文件（类似剧本脚本）。
    *   在代码中调用 `DialogueManager.show_dialogue_balloon(resource, "start")`。
    *   这比自己写 UI 和文本解析要快得多且稳定。

#### 2. 场景切换与数据持久化
*   当玩家从“封地”去“野外”战斗时，封地的状态（作物生长、门客工作）不能停止。
*   **解决方案**：
    *   不要销毁封地场景。只是 `remove_child` 并隐藏，或者使用 Godot 的 `change_scene_to_packed` 但将核心数据保存在 **Autoload (Global)** 中。
    *   更稳妥的做法：只切换 Viewport，或者将核心逻辑（时间流逝、作物生长）与场景节点解耦。即使场景不在树上，Global 里的 `TimeManager` 依然在计算时间，`CropManager` 依然在后台更新数据字典。

#### 3. 2D 射击手感
*   **箭矢**：建议使用 `Area2D` + 移动代码，而不是 `RigidBody2D`（物理引擎不可控因素太多）。
    ```gdscript
    # Arrow.gd
    func _physics_process(delta):
        position += transform.x * speed * delta
    
    func _on_body_entered(body):
        if body.is_in_group("enemies"):
            body.take_damage(damage)
            queue_free()
    ```

---

### 第三阶段交付物 (Deliverables)

1.  **角色成长**：玩家能看到自己的六艺属性在增长，并因此解锁了一个新配方（比如青铜斧）。
2.  **活的世界**：每隔几天会有 NPC 来访，能进行简单的对话。
3.  **战斗雏形**：能去野外射杀一只野猪，带回肉，并在祭祀台（新建筑）献祭掉，获得“礼”经验。
4.  **完整闭环 V0.3**：种田 -> 赚钱/纳贡 -> 练级 -> 杀怪 -> 升级爵位。

### 下一步（第四阶段）预告
完成这一步后，游戏的主体功能基本开发完毕。
第四阶段将进入 **“量产与打磨” (Production & Polish)**：
*   **内容填充**：从 1 种作物增加到 10 种，从 1 个敌人增加到 5 种。
*   **音乐音效**：实装编钟、古琴 BGM。
*   **存读档系统**：正式完善 Save/Load。
*   **UI 美化**：彻底替换掉所有 Godot 默认 UI。