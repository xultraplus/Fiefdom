# 第四阶段：量产、打磨与发布准备 (Production, Polish & Release Prep)

在前三个阶段中，我们分别完成了**核心玩法（Phase 1）**、**自动化管理（Phase 2）**和**RPG成长体系（Phase 3）**。
此时，你的游戏已经具备了完整的骨架，但它还只是一个“功能验证原型”（Greybox Prototype）。

**第四阶段（Phase 4）的核心目标**是：**“量产与体验升级”**。
这一阶段不再探索新机制，而是全力以赴地填充内容、提升视听表现、修复BUG，并完成一个可以面向玩家发布的**垂直切片（Vertical Slice）**或**抢先体验版（Early Access）**。

**建议周期**：6-8 周（量产工作量通常比预估的大）。

---

### 第四阶段开发计划表

#### 第一周：数据填充与内容量产 (Content Expansion)
**目标**：让游戏不再只有一种作物、一个敌人。

1.  **五谷与桑麻实装**：
    *   **配置数据**：在 `ItemData` 资源中录入“黍、稷、稻、麦、菽”以及“桑、麻”。
    *   **差异化**：
        *   *稻*：只能种在水田（需先挖水渠）。
        *   *桑*：多年生植物，不需要每季重种。
        *   *菽*（豆类）：有肥田功效，收获后恢复地块肥力。
2.  **敌人多样化**：
    *   新增敌人：
        *   *野狗*：速度快，血量低，偷吃公田作物。
        *   *蛮族斥候*：远程攻击（扔石头），会破坏围栏。
    *   **AI 行为树升级**：简单的“追逐”升级为“巡逻 -> 发现 -> 呼叫同伴 -> 攻击”。
3.  **节气事件表**：
    *   实现 24 个节气的轮转效果。
    *   **春分**：祭祀获得双倍声望。
    *   **大暑**：干旱概率增加，作物需水量加倍。

#### 第二周：存读档与系统功能 (Save/Load & Settings)
**目标**：让玩家的努力可以保存，游戏具备基本的软件功能。

1.  **存档系统架构**：
    *   **技术选型**：推荐使用 **JSON** 或 **Godot ConfigFile**（文本可读，方便调试），或者 `ResourceSaver`（二进制，防修改）。
    *   **序列化策略**：
        *   不要存整个节点树！
        *   只存数据：`{ "date": 12, "money": 500, "inventory": [...], "map_data": [...] }`。
        *   加载时：清空当前场景 -> 读取数据 -> 重新实例化节点。
2.  **设置菜单**：
    *   **音量控制**：Master / Music / SFX 三条总线（AudioBus）。
    *   **显示设置**：全屏/窗口切换，分辨率适配。
    *   **按键绑定**：利用 Godot 的 `InputMap` 系统实现改键功能。

#### 第三周：视听表现升级 (Audio & Visual Juice)
**目标**：把“好玩”变成“好看”和“好听”。

1.  **国风音效工程**：
    *   **BGM**：引入古琴、编钟的乐曲，实现“昼夜无缝切换”（利用 `AudioStreamPlayer` 的 `fade_in/out`）。
    *   **环境音**：风吹麦浪声、知了叫声（随季节变化）、雨声。
    *   **交互反馈**：点击 UI 的竹简展开声、金币入袋声、作物拔出的“啵”声。
2.  **视觉反馈 (Juice)**：
    *   **Tween 动画**：UI 面板弹出时不要硬切，加上缩放/透明度 Tween。
    *   **粒子系统**：耕地时扬起的尘土、收割时飞溅的叶子、攻击时的打击特效。
    *   **屏幕震动**：当玩家受到伤害或砍倒大树时，Camera2D 进行微小偏移。

#### 第四周：UI 重构与新手引导 (UI Polish & FTUE)
**目标**：彻底告别 Godot 默认的灰色方块 UI。

1.  **UI 皮肤全面替换**：
    *   **风格统一**：青铜器纹理（边框）、竹简/帛书（背景）、篆体/隶书（标题）。
    *   **Theme 资源**：在 Godot 中配置全局 `Theme`，统一字体颜色、字号、按钮样式。
2.  **HUD 优化**：
    *   动态血条/体力条（血扣了，红条有个缓慢下降的残影）。
    *   快捷栏：支持键盘数字键快速切换农具。
3.  **新手引导 (FTUE - First Time User Experience)**：
    *   **不要做大段文字教程**。
    *   **任务驱动**：开局给一个任务“向国君上缴 10 份黍”。
    *   **高亮引导**：用遮罩高亮显示当前需要点击的按钮（“请点击这里打开背包”）。

#### 第五周及以后：测试、优化与发布
1.  **性能优化**：
    *   使用 Godot Profiler 检查帧率瓶颈。
    *   如果同屏作物超过 1000 个，考虑使用 `MultiMeshInstance2D` 替代 Sprite。
2.  **Bug 狩猎**：
    *   重点测试：存档损坏问题、边界碰撞问题、逻辑死锁（如门客卡住）。
3.  **打包发布**：
    *   修改图标（Icon）、启动画面（Splash Screen）。
    *   导出 Windows / macOS / Linux 版本。
    *   如果上 Steam，接入 Steamworks SDK（Godot 有现成插件）。

---

### 关键技术难点与 Godot 解决方案

#### 1. 存档系统的版本兼容
*   **问题**：你发布了 v1.0，玩家存了档。下周你发布 v1.1，加了一个新属性，玩家读档时会报错或丢失数据。
*   **解决方案**：
    *   在存档文件中写入版本号 `{"version": "1.0", ...}`。
    *   加载时检查版本号，如果低于当前版本，执行 `upgrade_save_data()` 函数，给缺失的属性填入默认值。

#### 2. 音频管理 (AudioBus)
*   不要给每个 AudioStreamPlayer 单独调音量。
*   在 Godot 底部点击 **Audio** 标签，创建总线布局：
    *   Master
        *   BGM (发送到 Master)
        *   SFX (发送到 Master)
            *   UI_SFX
            *   World_SFX
*   代码中控制音量：`AudioServer.set_bus_volume_db(bus_index, linear_to_db(value))`。

#### 3. 异步加载场景
*   如果游戏资源变大，切换场景会卡顿。
*   使用 `ResourceLoader.load_threaded_request` 和 `ResourceLoader.load_threaded_get` 实现带进度条的加载界面。

---

### 第四阶段交付物 (Deliverables)

1.  **垂直切片 (Vertical Slice)**：一个完全代表最终品质的 30 分钟游戏体验。
    *   包含完整的 UI、音效、音乐。
    *   包含春夏秋冬四季变化。
    *   无严重 Bug。
2.  **安装包**：带有精美图标的 `.exe` 或 `.apk`。
3.  **宣传物料**：游戏截图、1分钟的玩法预告片（Trailer）。

### 结语
至此，你的《采邑春秋》开发路线图已完整规划。
*   **Phase 1**：造轮子（核心机制）。
*   **Phase 2**：装引擎（自动化系统）。
*   **Phase 3**：加内饰（RPG内容）。
*   **Phase 4**：上油漆（打磨量产）。

**接下来，请回到 Phase 1，开始写下第一行代码吧！祝你好运，士大夫！**
