# 核心玩法缺失分析

> **最新更新**：2026-01-28
> 项目：《采邑春秋》(Project: Fiefdom)
> 开发进度：Phase 1-4 约60-70%完成

## 📝 更新日志

**2026-01-28**：
- ✅ **设计文档更新**：新增"井田制扩展系统"（爵位解锁机制）
- ✅ **设计文档更新**：新增"初税亩改革事件"详细设计（法家/儒家路线选择）
- 📋 将田地扩展和改革事件从"缺失"移至"已设计，待实现"

---

## 📊 开发进度概览

| 阶段 | 名称 | 完成度 | 状态 |
|------|------|--------|------|
| Phase 1 | 核心机制（井田制） | 100% | ✅ 已完成 |
| Phase 2 | 门客与经济 | 90% | ✅ 基本完成 |
| Phase 3 | RPG成长（六艺） | 80% | ✅ 架构完成，玩法待深化 |
| Phase 4 | 量产打磨 | 60% | ⚠️ 部分完成 |
| Phase 5 | 深度机制与文化补完 | 0% | ❌ 未开始 |

---

## 🎯 已设计，待实现（2026-01-28更新）

### 1. 井田制扩展系统（爵位解锁）

**设计文档位置**：`docs/核心设计.md` - 3.1.2章节

**设计内容**：
- ✅ 爵位与井田数量对应关系（下士1个 → 卿16个）
- ✅ 开垦新井田的完整流程（5天工期）
- ✅ 地形限制与边界情况处理
- ✅ 井田之间间距要求（防止视觉混乱）
- ✅ 技术实现方案（WellFieldData数据结构）

**实现优先级**：🔴 高

**实现要点**：
- 新增数据结构：`WellFieldData` 资源类
- 田地开垦UI（显示可用区域、消耗预览）
- 开垦过程可视化（荒地→净地→松土→可耕地）
- 爵位提升时的解锁动画

---

### 2. 初税亩改革事件（后期重大选择）

**设计文档位置**：`docs/核心设计.md` - 3.1.3章节

**设计内容**：
- ✅ 事件触发条件（第3年/爵位达大夫）
- ✅ 三种路线选择（法家/儒家/观望）
- ✅ 每种路线的详细后果（经济、门客、外交影响）
- ✅ 改革后的经济平衡表
- ✅ 设计意图与胜利路径

**实现优先级**：🔴 高

**实现要点**：
- 事件系统架构（EventDialog、BranchingChoice）
- 存档机制（`Global.tax_reform_choice`）
- 条件事件触发（如"孔子来访"仅儒家路线）
- UI提示（改革后公田变为私田样式）

**为何重要**：
- 这是游戏后半段的核心转折点
- 提供重玩价值（不同路线不同体验）
- 体现春秋时期"礼崩乐坏"的历史主题

---

## 🔴 高优先级缺失（影响核心体验）

### 1. 桑蚕产业链系统

**设计文档位置**：`docs/核心设计.md` - "经济系统"章节

**缺失内容**：
- ❌ **养蚕系统**
  - 蚕房建造与管理
  - 温度控制机制（影响蚕的生长速度）
  - 桑叶喂养（需要定期添加）
  - 蚕的生命周期（蚁蚕 → 一龄 → 二龄 → 三龄 → 四龄 → 蛹 → 蛾）

- ❌ **缫丝机制**
  - 煮茧工艺（水温控制）
  - 抽丝工艺（技能检定）
  - 丝的品质等级（受"六艺·礼"和"六艺·数"影响）

- ❌ **织造系统**
  - 织布机操作
  - 丝绸成品（粗丝、细丝、锦缎）
  - 染色工艺（使用植物染料）

- ❌ **丝绸经济功能**
  - 作为高级货币（比铜币更贵重）
  - 向贵族/士大夫送礼提升声望
  - 作为贡品向周王室上缴

**为何重要**：
- 这是游戏区别于其他种田游戏的**核心特色**
- 春秋时期"男耕女织"的经济形态需要通过桑蚕系统体现
- 丝绸贸易是后期经济升级的关键

**技术实现要点**：
```
建议新增数据结构：
- SilkwormData: 蚕的数据（年龄、健康度、成长阶段）
- SericultureRoomData: 蚕房数据（温度、桑叶存量、蚕的列表）
- SilkData: 丝绸成品（品质、产地、染色）
```

---

### 2. 六艺具体玩法（RPG深度）

**设计文档位置**：`docs/核心设计.md` - "六艺系统"章节

**当前状态**：
- ✅ 数据结构完整（`PlayerStats`中的六艺属性）
- ✅ 经验获取与升级机制
- ❌ **具体玩法缺失**：六艺只是数字，没有可玩性

#### 2.1 礼（Yili）- 礼仪
**设计内容**：
- ❌ 朝觐小游戏（正确的跪拜、献礼、答辞）
- ❌ 宴会礼仪（座位安排、酒礼）
- ❌ 丧礼/婚礼仪式执行

**实现方式**：QTE（Quick Time Event）序列检定

#### 2.2 乐（Yue）- 音乐
**设计内容**：
- ❌ **编钟音游小游戏**（Phase 5核心玩法）
  - 模拟编钟演奏（不同大小编钟对应不同音高）
  - 《诗经》曲目演奏（如《关雎》《鹿鸣》）
  - 节奏检定（Timing Accuracy）
  - 和声系统（多层编钟合奏）

**技术方案**：
```
- 使用AudioStreamSample加载编钟音效
- 简单的节奏谱记谱系统
- 连击数（Combo）与六艺经验挂钩
```

#### 2.3 射（She）- 射艺
**设计内容**：
- ⚠️ 已有基础射箭机制
- ❌ 射礼流程（乡射礼）
- ❌ 不同箭矢类型（矢、镞）
- ❌ 移动靶射击

#### 2.4 御（Yu）- 驾驭
**设计内容**：
- ❌ **战车驾驶**（Phase 5核心玩法）
  - 战车控制（马匹、车辕、轮轴）
  - 战车冲撞（伤害计算）
  - 马匹培育（良马系统）

**技术挑战**：需要新的物理模型（车辆动力学）

#### 2.5 书（Shu）- 书法
**设计内容**：
- ❌ **竹简修复小游戏**
  - 破碎竹简拼图（Puzzle）
  - 笔画顺序描红
  - 文字辨识（甲骨文→金文→小篆）

#### 2.6 数（Shu）- 算术
**设计内容**：
- ❌ 筹算小游戏（古代算盘）
- ❌ 丈量土地（井田划分）
- ❌ 税收计算

**为何重要**：
- 六艺是"士"的身份标识，应该有实际玩法而非仅仅属性
- 不同小游戏可以对应春秋时期的不同文化活动
- 增加游戏的RPG深度

---

### 3. 门客学派特质系统

**设计文档位置**：`docs/核心设计.md` - "门客系统"章节

**当前状态**：
- ✅ 基础门客管理（招募、指派、忠诚度）
- ✅ 门客AI（寻路、工作）
- ❌ **学派特质缺失**：门客只是劳动力，没有独特价值

**缺失的学派特质**：

#### 3.1 墨家（Mohism）
- ❌ **自动修缮设施**
  - 定期检查并修复建筑耐久度
  - 不需要玩家手动维护

- ❌ **机关术加成**
  - 防御建筑（烽火台）效率提升
  - 墨家机关兽（自动巡逻单位）

#### 3.2 儒家（Confucianism）
- ❌ **忠诚度光环**
  - 提升周围门客的忠诚度
  - 降低叛变概率

- ❌ **教育功能**
  - 教授玩家六艺（经验获取加成）
  - 传授特殊技能（如礼仪知识）

#### 3.3 兵家（Military Strategists）
- ❌ **主动攻击敌人**
  - 自动出击剿灭入侵者
  - 不需要玩家亲自战斗

- ❌ **防御战术**
  - 组织门客巡逻
  - 战斗时提升周围单位战斗力

#### 3.4 农家（Agrarianism）
- ❌ **种植效率加成**
  - 作物生长速度提升
  - 收成量增加

- ❌ **农具创新**
  - 解锁新农具（如铁犁、耧车）
  - 耕作技术改良

**实现方式**：
```gdscript
# 在 RetainerData 中添加学派字段
class_name RetainerData extends Resource
@export var school: String = ""  # "mohism", "confucianism", "military", "agrarian"

# 在门客工作循环中添加学派特性
func apply_school_ability():
    match school:
        "mohism":
            repair_nearby_structures()
        "confucianism":
            buff_loyalty_aura()
        # ...
```

**为何重要**：
- 增加门客管理的策略深度（不同学派搭配产生不同效果）
- 体现春秋"百家争鸣"的文化背景
- 让玩家在招募门客时有选择而非随机

---

## 🟡 中优先级缺失（丰富体验）

### 4. 水利系统

**设计文档位置**：`docs/游戏玩法.md` - "水利科技"章节

**当前状态**：
- ✅ 科技树中有"水利工程"数据
- ✅ UI按钮已实现
- ❌ **实际玩法未实现**

**缺失内容**：
- ❌ **沟渠建造**
  - 使用工具挖掘沟渠
  - 沟渠需要连接水源（河流/湖泊）

- ❌ **水源传导机制**
  - 水源沿着沟渠扩散
  - 距离衰减（太远的水田无法灌溉）

- ❌ **水田限制**
  - 稻作只能种植在水田中
  - 水田定义为：与沟渠/水源相邻的耕地

- ❌ **水利等级**
  - 初级：简单沟渠（灌溉范围1格）
  - 中级：石砌水渠（灌溉范围2格）
  - 高级：郑国渠/都江堰式大型水利工程（全地图灌溉）

**技术实现要点**：
```gdscript
# 建议新增TileMapLayer
var water_layer: TileMapLayer  # 用于渲染沟渠

# 水源传导算法
func calculate_irrigation():
    # 使用BFS（广度优先搜索）计算每个格子是否可灌溉
    var queue = []  # 存储水源点
    var irrigated = {}  # 记录已灌溉的格子
    # ...
```

---

### 5. 进阶战斗系统

**设计文档位置**：`docs/核心设计.md` - "战斗系统"章节

**缺失内容**：

#### 5.1 防御建筑
- ❌ **烽火台**
  - 自动发现敌人
  - 点燃狼烟报警
  - 远程箭矢攻击

- ❌ **城墙/栅栏**
  - 阻挡敌人进入领地
  - 耐久度系统

#### 5.2 上古异兽Boss
- ❌ **夔牛**（Kui Niu）
  - 传说中的神兽
  - 高生命值、高伤害
  - 击杀后获得特殊素材（夔牛皮制鼓）

- ❌ **虎蛟**（Hu Jiao）
  - 鱼身蛇尾的异兽
  - 水陆两栖
  - 掉落珍贵的珍珠

#### 5.3 被俘机制
- ❌ **玩家被俘**
  - 战斗失败后被敌人俘虏
  - 需要支付赎金（或门客救援）
  - 被俘期间无法管理领地

- ❌ **门客被俘**
  - 门客战败被敌人抓走
  - 需要玩家去营救
  - 长期未救回会叛变

**为何重要**：
- 当前战斗过于简单（只是射箭）
- Boss战增加后期挑战性
- 被俘机制增加风险与代价

---

### 6. 随机事件系统

**设计文档位置**：`docs/核心设计.md` - "历史事件"章节

**缺失内容**：

#### 6.1 天气灾害
- ❌ 干旱（作物生长停止）
- ❌ 洪水（冲毁农田）
- ❌ 蝗灾（作物被吃）
- ❌ 应对措施：祭祀、开仓放粮

#### 6.3 周王评价系统
- ❌ **周礼评分**
  - 考核玩家的"礼"（朝觐、贡品）
  - 评级：上上、上中、上下...下下
  - 影响爵位升迁

- ❌ **诸侯会盟**
  - 定期参加诸侯盟会
  - 政治站队（晋楚争霸）
  - 影响声望和外交

**实现方式**：
```gdscript
# 建议新增EventManager
class_name EventManager extends Node

signal event_triggered(event_data: Dictionary)

func check_daily_events():
    if should_trigger_drought():
        trigger_event("drought")

func trigger_event(event_id: String):
    var event = load_event_data(event_id)
    event_dialog.show(event)
```

---

## 🟢 低优先级缺失（打磨与优化）

### 7. 美术风格统一

**当前状态**：
- ✅ 核心机制使用占位美术
- ❌ **青绿山水风格未实现**
- ❌ **青铜美学UI未实现**

**缺失内容**：
- ❌ TileSet重新设计（使用青绿山水配色）
- ❌ UI主题更新（青铜器纹样、钟鼎文装饰）
- ❌ 角色动画优化
- ❌ 特效（如编钟演奏时的光效）

**为何重要**：
- 当前美术风格不统一，缺少文化特色
- 好的美术能显著提升游戏质感

---

### 8. 音效与音乐

**缺失内容**：
- ❌ 编钟音效（六艺·乐玩法必需）
- ❌ 背景音乐（古琴、箫等古代乐器）
- ❌ 环境音效（农田、森林、河流）
- ❌ UI音效（按钮点击、收获作物）

---

## 📋 完整缺失功能清单

### 已设计，待实现（2026-01-28新增）

| 功能模块 | 子功能 | 优先级 | 依赖 | 设计文档 |
|---------|-------|-------|------|---------|
| 井田制扩展 | 爵位解锁机制 | 🔴 高 | 无 | 3.1.2章节 |
| 井田制扩展 | 田地开垦流程 | 🔴 高 | 地形系统 | 3.1.2章节 |
| 井田制扩展 | WellFieldData数据结构 | 🔴 高 | 无 | 3.1.2章节 |
| 初税亩改革 | 事件系统架构 | 🔴 高 | 对话系统 | 3.1.3章节 |
| 初税亩改革 | 法家/儒家路线 | 🔴 高 | 门客系统 | 3.1.3章节 |
| 初税亩改革 | 后续条件事件 | 🔴 高 | 事件系统 | 3.1.3章节 |

### Phase 5 深度机制（0%完成）

| 功能模块 | 子功能 | 优先级 | 依赖 |
|---------|-------|-------|------|
| 桑蚕系统 | 养蚕 | 🔴 高 | 无 |
| 桑蚕系统 | 缫丝 | 🔴 高 | 养蚕 |
| 桑蚕系统 | 织造 | 🔴 高 | 缫丝 |
| 桑蚕系统 | 丝绸贸易 | 🔴 高 | 织造 |
| 六艺·礼 | 朝觐小游戏 | 🔴 高 | 对话系统 |
| 六艺·乐 | 编钟音游 | 🔴 高 | 音效资源 |
| 六艺·射 | 射礼流程 | 🟡 中 | 基础射箭 |
| 六艺·御 | 战车驾驶 | 🔴 高 | 物理引擎 |
| 六艺·书 | 竹简修复 | 🟡 中 | Puzzle系统 |
| 六艺·数 | 筹算游戏 | 🟡 中 | 无 |
| 门客学派 | 墨家特质 | 🔴 高 | 门客系统 |
| 门客学派 | 儒家特质 | 🔴 高 | 门客系统 |
| 门客学派 | 兵家特质 | 🔴 高 | 战斗系统 |
| 门客学派 | 农家特质 | 🔴 高 | 种植系统 |
| 水利系统 | 沟渠建造 | 🟡 中 | TileMap扩展 |
| 水利系统 | 水源传导 | 🟡 中 | 沟渠建造 |
| 战斗系统 | 烽火台 | 🟡 中 | 建筑系统 |
| 战斗系统 | 夔牛Boss | 🟡 中 | AI系统 |
| 战斗系统 | 被俘机制 | 🟢 低 | 战斗UI |
| 事件系统 | 天气灾害 | 🟡 中 | 作物系统 |
| 事件系统 | 周礼评价 | 🟢 低 | 六艺系统 |
| 美术 | 青绿山水TileSet | 🟢 低 | 美术资源 |
| 美术 | 青铜UI主题 | 🟢 低 | UI重构 |
| 音效 | 编钟音效 | 🔴 高 | 音频资源 |
| 音效 | BGM | 🟢 低 | 作曲 |
| 音效 | 环境音效 | 🟢 低 | 音效库 |

---

## 🎯 开发优先级建议

### 第0阶段（已设计，立即实现）
1. **井田制扩展系统** - 爵位解锁与田地开垦
2. **初税亩改革事件** - 后期核心转折点

### 第一阶段（必须完成，影响核心体验）
3. **桑蚕产业链** - 游戏独特性的核心
4. **门客学派特质** - 增加管理策略性
5. **编钟音游（六艺·乐）** - 最具文化特色的小游戏

### 第二阶段（显著提升可玩性）
6. **水利系统** - 完善农业机制
7. **战车驾驶（六艺·御）** - 战斗玩法升级
8. **朝觐小游戏（六艺·礼）** - RPG内容补充

### 第三阶段（丰富细节）
9. **防御建筑与Boss战** - 战斗深化
10. **随机事件系统** - 增加动态性
11. **其他六艺小游戏**（书、数、射礼）- 内容补完

### 第四阶段（打磨阶段）
12. **美术风格统一** - 从原型走向完整游戏
13. **音效与音乐** - 提升沉浸感

---

## 📝 技术债务

当前代码库中存在的技术债务：

1. **Magic Numbers**
   - 作物生长天数硬编码在代码中
   - 应该移到CropData资源文件

2. **UI耦合**
   - UIManager.gd 职责过多（应该拆分为多个Controller）
   - 建议使用MVC/MVVM模式重构

3. **缺少配置文件**
   - 游戏平衡参数分散在各个脚本中
   - 建议创建 `BalanceData.tres` 统一管理

4. **测试覆盖**
   - 缺少自动化测试
   - 建议使用GdUnit4编写核心逻辑测试

---

## 🔗 相关文档

- `docs/核心设计.md` - 完整游戏设计文档
- `docs/游戏玩法.md` - 详细玩法说明
- `docs/phase/Phase1.md` - Phase 1开发计划（已完成）
- `docs/phase/phase2.md` - Phase 2开发计划（已完成）
- `docs/phase/phase3.md` - Phase 3开发计划（已完成）
- `docs/phase/phase4.md` - Phase 4开发计划（部分完成）
- `docs/phase/phase5.md` - Phase 5开发计划（未开始）

---

## 📅 最后更新

- **分析日期**：2026-01-28
- **分析人员**：Claude Code
- **下次审查**：完成Phase 5第一阶段后
